const fs = require('fs');
const { promisify } = require('util');
const readFile = promisify(fs.readFile);
const { exec } = require("child_process");
const ipPrefix = '10.10.0.'
const ipStart = 101;
const ipEnd = 128;

async function run() {
    const entries = await readFile(__dirname + '/exploits.txt', { encoding: 'utf-8' });
    const commands = entries.split(/\n/);
    for (let i = ipStart; i <= ipEnd; i++) {
        if (i == 126) {
            continue;
        }
        const ip = ipPrefix + i;
        for (let command of commands) {
            exec(command + ' ' + ip, (err, stdout, stderr) => {
                if (err) {
                    console.error('FATAL: couldn\'t start process ' + command);
                    console.error(err);
                }
                if (stderr) {
                    console.error(stderr);
                }
                if (stdout) {
                    console.log(stdout);
                }
            })
        }
    }
}
run();
setInterval(run, 5 * 60 * 1000);//once per 5 min
